<!DOCTYPE html>
<html lang="vi" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√°y T√≠nh Tu·ªïi Thai</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* CSS t√πy ch·ªânh */
        :root {
            --primary-color-light: #7952b3;
            --primary-color-dark: #9d8fbf;
            --bg-light: #f8f9fa;
            --bg-dark: #212529;
            --card-bg-light: #ffffff;
            --card-bg-dark: #343a40;
            --text-color-light: #212529;
            --text-color-dark: #f8f9fa;
        }

        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-color-light);
            transition: background-color 0.3s, color 0.3s;
        }

        [data-bs-theme="dark"] body {
            background-color: var(--bg-dark);
            color: var(--text-color-dark);
        }

        .main-container {
            min-height: 100vh;
        }

        .calculator-card {
            background-color: var(--card-bg-light);
            border: 1px solid rgba(0,0,0,.125);
            transition: background-color 0.3s;
        }

        [data-bs-theme="dark"] .calculator-card {
            background-color: var(--card-bg-dark);
            border-color: rgba(255,255,255,.125);
        }

        .btn-custom {
            background-color: var(--primary-color-light);
            border-color: var(--primary-color-light);
            color: white;
        }

        .btn-custom:hover {
            opacity: 0.9;
            color: white;
        }
        
        [data-bs-theme="dark"] .btn-custom {
            background-color: var(--primary-color-dark);
            border-color: var(--primary-color-dark);
        }
        
        h1 {
            color: var(--primary-color-light);
        }

        [data-bs-theme="dark"] h1 {
            color: var(--primary-color-dark);
        }

        .result-display {
            background-color: #e9ecef;
            border-left: 5px solid var(--primary-color-light);
        }
        
        [data-bs-theme="dark"] .result-display {
            background-color: #495057;
            border-left-color: var(--primary-color-dark);
        }

        .dark-mode-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 1050;
        }
    </style>
</head>
<body>

    <!-- N√∫t chuy·ªÉn ƒë·ªïi Dark Mode -->
    <button class="btn btn-outline-secondary dark-mode-toggle" id="darkModeToggle">
        <i class="bi bi-moon-stars-fill"></i>
    </button>

    <div class="container d-flex flex-column justify-content-center align-items-center main-container p-3">

        <!-- Ti√™u ƒë·ªÅ ch√≠nh -->
        <h1 class="text-center fw-bold mb-4">M√°y T√≠nh Tu·ªïi Thai</h1>

        <!-- Khung ch√≠nh c·ªßa ·ª©ng d·ª•ng -->
        <div class="col-12 col-md-8 col-lg-6">
            <div class="card shadow-lg calculator-card p-4 rounded-4">
                <div class="card-body">
                    
                    <!-- Form nh·∫≠p li·ªáu -->
                    <div class="mb-4">
                        <label for="lmpDate" class="form-label fs-5 fw-medium">Ng√†y ƒë·∫ßu c·ªßa k·ª≥ kinh cu·ªëi (LMP):</label>
                        <input type="date" class="form-control form-control-lg" id="lmpDate">
                        <div id="dateError" class="text-danger mt-2 d-none">Vui l√≤ng ch·ªçn m·ªôt ng√†y h·ª£p l·ªá.</div>
                    </div>

                    <!-- C√°c n√∫t ch·ª©c nƒÉng -->
                    <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
                        <button class="btn btn-custom btn-lg flex-sm-fill" id="calculateBtn">
                            <i class="bi bi-calculator-fill me-2"></i>T√≠nh to√°n
                        </button>
                        <button class="btn btn-secondary btn-lg flex-sm-fill" id="clearBtn">
                            <i class="bi bi-arrow-clockwise me-2"></i>X√≥a
                        </button>
                    </div>

                    <!-- Khu v·ª±c hi·ªÉn th·ªã k·∫øt qu·∫£ -->
                    <div id="result" class="mt-5 d-none">
                        <hr>
                        <h3 class="text-center mb-4 fw-medium">K·∫øt qu·∫£ ∆∞·ªõc t√≠nh</h3>
                        <div class="result-display p-3 rounded-3">
                            <p class="fs-5 mb-2">
                                <strong class="fw-medium">üìÖ Ng√†y d·ª± sinh (EDD):</strong>
                                <span id="dueDate" class="fw-bold"></span>
                            </p>
                            <p class="fs-5 mb-0">
                                <strong class="fw-medium">ü§∞ Tu·ªïi thai hi·ªán t·∫°i:</strong>
                                <span id="gestationalAge" class="fw-bold"></span>
                            </p>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-5 text-center text-muted">
            <p>DOTPHONGLONG Mini App</p>
        </footer>
    </div>

    <!-- Bootstrap JS v√† Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // L·∫•y c√°c ph·∫ßn t·ª≠ DOM
            const lmpDateInput = document.getElementById('lmpDate');
            const calculateBtn = document.getElementById('calculateBtn');
            const clearBtn = document.getElementById('clearBtn');
            const resultDiv = document.getElementById('result');
            const dueDateSpan = document.getElementById('dueDate');
            const gestationalAgeSpan = document.getElementById('gestationalAge');
            const dateError = document.getElementById('dateError');
            const darkModeToggle = document.getElementById('darkModeToggle');
            const htmlElement = document.documentElement;

            // --- Ch·ª©c nƒÉng Chuy·ªÉn ƒë·ªïi Dark Mode ---
            darkModeToggle.addEventListener('click', () => {
                const currentTheme = htmlElement.getAttribute('data-bs-theme');
                if (currentTheme === 'dark') {
                    htmlElement.setAttribute('data-bs-theme', 'light');
                    darkModeToggle.innerHTML = '<i class="bi bi-moon-stars-fill"></i>';
                } else {
                    htmlElement.setAttribute('data-bs-theme', 'dark');
                    darkModeToggle.innerHTML = '<i class="bi bi-sun-fill"></i>';
                }
            });

            // --- Ch·ª©c nƒÉng T√≠nh to√°n ---
            calculateBtn.addEventListener('click', () => {
                const lmpDateValue = lmpDateInput.value;

                // Ki·ªÉm tra xem ng∆∞·ªùi d√πng ƒë√£ nh·∫≠p ng√†y ch∆∞a
                if (!lmpDateValue) {
                    dateError.classList.remove('d-none');
                    resultDiv.classList.add('d-none');
                    return;
                }
                dateError.classList.add('d-none');

                // Chuy·ªÉn ƒë·ªïi chu·ªói ng√†y th√†nh ƒë·ªëi t∆∞·ª£ng Date
                // Th√™m 'T00:00:00' ƒë·ªÉ tr√°nh c√°c v·∫•n ƒë·ªÅ v·ªÅ m√∫i gi·ªù
                const lmpDate = new Date(lmpDateValue + 'T00:00:00');
                
                if (isNaN(lmpDate.getTime())) {
                    dateError.classList.remove('d-none');
                    resultDiv.classList.add('d-none');
                    return;
                }

                // 1. T√≠nh ng√†y d·ª± sinh (EDD = LMP + 280 ng√†y)
                const dueDate = new Date(lmpDate);
                dueDate.setDate(lmpDate.getDate() + 280);

                // 2. T√≠nh tu·ªïi thai hi·ªán t·∫°i
                const today = new Date();
                // Reset gi·ªù, ph√∫t, gi√¢y ƒë·ªÉ ch·ªâ so s√°nh ng√†y
                today.setHours(0, 0, 0, 0);

                // N·∫øu ng√†y kinh cu·ªëi sau ng√†y h√¥m nay, kh√¥ng h·ª£p l·ªá
                if(lmpDate > today) {
                    dateError.textContent = 'Ng√†y kinh cu·ªëi kh√¥ng th·ªÉ ·ªü t∆∞∆°ng lai.';
                    dateError.classList.remove('d-none');
                    resultDiv.classList.add('d-none');
                    return;
                } else {
                     dateError.textContent = 'Vui l√≤ng ch·ªçn m·ªôt ng√†y h·ª£p l·ªá.'; // Reset message
                }


                const diffTime = Math.abs(today - lmpDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                const weeks = Math.floor(diffDays / 7);
                const days = diffDays % 7;

                // ƒê·ªãnh d·∫°ng ng√†y th√°ng sang DD/MM/YYYY
                const formatDate = (date) => {
                    const day = String(date.getDate()).padStart(2, '0');
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const year = date.getFullYear();
                    return `${day}/${month}/${year}`;
                };

                // 3. Hi·ªÉn th·ªã k·∫øt qu·∫£
                dueDateSpan.textContent = formatDate(dueDate);
                gestationalAgeSpan.textContent = `${weeks} tu·∫ßn v√† ${days} ng√†y`;
                resultDiv.classList.remove('d-none');
            });

            // --- Ch·ª©c nƒÉng X√≥a ---
            clearBtn.addEventListener('click', () => {
                lmpDateInput.value = '';
                resultDiv.classList.add('d-none');
                dateError.classList.add('d-none');
            });

        });
    </script>

</body>
</html>
